# 設計書 - Project Back-Scheduler (Tagging Feature)

## 1. データモデル変更

### 1.1 Global State
プロジェクト全体で利用可能なタグを管理するための配列を追加する。

```javascript
/* src/state.js 定義 */
{
  // ...既存プロパティ
  
  // [NEW] グローバルタグ定義
  tags: [
    { id: "tag-001", name: "Design", color: "#FFB6C1" }, // ID, 名称, カラーコード
    { id: "tag-002", name: "Dev", color: "#87CEFA" }
  ]
}
```

### 1.2 Phase オブジェクト
フェーズごとにタグを参照するためのID配列を追加する。

```javascript
/* src/state.js 定義 */
{
  id: "phase-abc",
  name: "UI実装",
  // ...既存プロパティ
  
  // [NEW] 適用タグIDの配列（最大3つ）
  tagIds: ["tag-002"] 
}
```

## 2. UI/UX デザイン

### 2.1 タグ管理 (Settings Panel)
*   **場所**: 左カラム下部の設定パネル内に「タグ設定」セクションを追加。
*   **機能**:
    *   **一覧表示**: 作成済みタグのリスト（色と名前）。
    *   **追加**: 名前入力 + カラーピッカー → 「追加」ボタン。
    *   **削除**: 各タグ横の削除ボタン（使用中のタグを削除した場合の警告または自動解除処理を含む）。

### 2.2 タグ適用 (Phase Modal)
*   **場所**: フェーズ追加/編集モーダル内。
*   **UIコンポーネント**:
    *   **タグ選択エリア**: 作成済みタグ一覧をチップ形式で表示。クリックで選択/解除（トグル）。
    *   **制限**: 選択数が3つを超えた場合、新たな選択をブロックまたは古いものを押し出す（ブロック推奨）。
    *   **表示**: 選択中のタグは枠線強調またはチェックマーク表示。

### 2.3 タグ表示
*   **スケジュール一覧**: フェーズ名の下にタグチップ（色付き背景、小フォント）を表示。
*   **ガントチャート**: バーのツールチップ内、または余裕があればバーの横に色付きドット等を配置。

### 2.4 フィルタリング機能
*   **場所**: メイン画面ヘッダー（Timeline切替の横など）。
*   **UI**: "Filter by Tag" ドロップダウン。
*   **挙動**:
    *   タグを選択すると、そのタグを持つフェーズ（`tagIds`に含む）のみを表示。
    *   **ガントチャート**: 非該当の行は非表示（高さ0またはDOM削除）にし、該当行を上に詰めて表示する。
    *   **スプリント行**: 配下のフェーズが1つでも表示されていればスプリント行も表示。全フェーズが非表示ならスプリント行も非表示。

## 3. 実装方針
*   **データマイグレーション**: 既存データを読み込んだ際、`state.tags` がなければ空配列で初期化。`phase.tagIds` がなければ空配列で初期化。
*   **State管理**: `addTag`, `deleteTag`, `assignTagToPhase` などのアクション関数を `state.js` または `tags.js`（新規検討）に追加。
*   **レンダリング**: `ui.js` (リスト) と `gantt.js` (チャート) の描画ループ内で、現在の「フィルタ状態」をチェックし、描画スキップ判定を入れる。
