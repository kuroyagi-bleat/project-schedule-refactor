# 要件定義書 - Project Back-Scheduler

## 1. 概要

### 1.1 目的
プロジェクトのスケジュールを**逆算**で簡単に計画できるWebアプリケーション。完了日（リリース日）を基準に、各工程の期間を入力することで、開始日や中間期日を自動計算する。

### 1.2 ターゲットユーザー
- プロジェクトマネージャー
- 開発リーダー
- スクラムマスター

---

## 2. 機能要件

### 2.1 スプリント（タイムライン）管理

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-001 | スプリント追加 | 新しいスプリント（タイムライン）を作成する | 高 |
| F-002 | スプリント切替 | 複数のスプリント間を切り替える | 高 |
| F-003 | スプリント名変更 | スプリントの名称を編集する | 中 |
| F-004 | スプリント削除 | 不要なスプリントを削除する | 中 |

### 2.2 フェーズ（工程）管理

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-010 | フェーズ追加 | 新しいフェーズを追加する | 高 |
| F-011 | フェーズ削除 | 不要なフェーズを削除する | 高 |
| F-012 | フェーズ名編集 | フェーズの名称を変更する | 高 |
| F-013 | 工数日数設定 | フェーズの営業日数を設定する | 高 |
| F-014 | フェーズ並替 | ドラッグ＆ドロップでフェーズ順序を変更する | 中 |
| F-015 | 並行フェーズ設定 | 他フェーズと並行して実行されるフェーズを設定する | 中 |

### 2.3 基準日（アンカー）設定

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-020 | 基準日設定 | スケジュール計算の基準となる日付を設定する | 高 |
| F-021 | 基準工程選択 | どのフェーズの開始/完了を基準とするか選択する | 高 |
| F-022 | 開始/完了切替 | 基準工程の開始日または完了日を基準とするか選択する | 高 |

### 2.4 スケジュール計算・表示

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-030 | 自動日程計算 | 基準日から各フェーズの日程を自動計算する | 高 |
| F-031 | スケジュール表示 | 計算結果を左カラムに一覧表示する | 高 |
| F-032 | 昇順/降順切替 | スケジュール表示の並び順を切り替える | 低 |
| F-033 | クリップボードコピー | スケジュールをテキストとしてコピーする | 低 |

### 2.5 ガントチャート

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-040 | ガントチャート表示 | スケジュールをガントチャート形式で視覚化する | 高 |
| F-041 | 今日線表示 | ガントチャート上に現在日を示す線を表示する | 中 |
| F-042 | 土日祝日表示 | 土日・祝日をハイライト表示する | 中 |
| F-043 | 画像保存 | ガントチャートをPNG画像として保存する | 低 |

### 2.6 設定機能

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-050 | 祝日設定 | 祝日・休業日を設定する | 中 |
| F-051 | 設定パネル表示/非表示 | 設定パネルをトグル表示する | 低 |

### 2.7 データ管理

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-060 | データ保存 | 現在の状態をJSONファイルとして保存する | 高 |
| F-061 | データ読込 | JSONファイルから状態を復元する | 高 |
| F-062 | 自動保存 | LocalStorageに状態を自動保存する | 高 |
| F-063 | Undo機能 | 直前の操作を取り消す | 中 |
| F-064 | Redo機能 | 取り消した操作をやり直す | 中 |

### 2.8 キーボードショートカット

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-070 | Undo (Ctrl/Cmd+Z) | キーボードでUndo実行 | 中 |
| F-071 | Redo (Ctrl/Cmd+Shift+Z) | キーボードでRedo実行 | 中 |
| F-072 | Save (Ctrl/Cmd+S) | キーボードで保存実行 | 低 |

### 2.9 Chrome拡張機能

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-080 | 拡張機能起動 | ブラウザツールバーのアイコンから起動できる | 高 |
| F-081 | 新規タブ表示 | 起動時に新しいタブで全画面表示する | 高 |

---

## 3. 非機能要件

### 3.1 パフォーマンス
- ページ読込時間: 3秒以内
- 日程再計算: 100ms以内

### 3.2 互換性
- Chrome (最新版)
- Firefox (最新版)
- Safari (最新版)
- Edge (最新版)

### 3.3 アクセシビリティ
- キーボード操作対応
- 適切なタイトル・ラベル設定

### 3.4 セキュリティ
- XSSエスケープ処理
- ローカルストレージのみ使用（サーバー送信なし）

---

## 4. 技術仕様

### 4.1 技術スタック
- フロントエンド: HTML5, CSS3, Vanilla JavaScript (ES Modules)
- 状態管理: LocalStorage
- ビルドツール: なし（フレームワークレス）

### 4.2 モジュール構成
| ファイル | 役割 |
|:---|:---|
| `main.js` | エントリポイント、イベント登録 |
| `config.js` | 設定定数、デフォルト値 |
| `state.js` | 状態管理、LocalStorage連携 |
| `scheduler.js` | 日程計算ロジック |
| `dateUtils.js` | 日付操作ユーティリティ |
| `ui.js` | DOM操作、UI描画 |
| `gantt.js` | ガントチャート描画 |
| `history.js` | Undo/Redo履歴管理 |

---

## 5. 変更履歴

| バージョン | 日付 | 内容 |
|:---|:---|:---|
| 1.0.0 | 2026-02-08 | 初版作成（Phase 1-2完了） |
| 1.1.0 | 2026-02-08 | Undo/Redo機能追加（Phase 3完了） |
| 1.2.0 | 2026-02-08 | UI/UX改善（Phase 5完了） |
| 1.3.0 | 2026-02-09 | Chrome拡張機能化（Phase 6完了） |
| 1.4.0 | 2026-02-XX | タグ機能追加（Phase 7予定） |
| 1.5.0 | 2026-02-09 | 並行工程営業日計算修正 |
| 1.6.0 | 2026-02-10 | 行程の複数選択・一括移動（Phase 12完了） |

### 2.10 タグ機能 (Phase 7)

| ID | 機能名 | 説明 | 優先度 |
|:---|:---|:---|:---:|
| F-090 | タグ管理 (Global) | プロジェクト全体で使用するタグを作成・編集・削除する（名前、色指定）。 | 高 |
| F-091 | タグ適用 | 各フェーズに作成済みタグを割り当てる（最大3つまで、選択式）。 | 高 |
| F-092 | タグ表示 | スケジュール一覧およびガントチャート上でタグ名と色を表示する。 | 高 |
| F-093 | タグフィルタ | 指定したタグを持つフェーズのみを表示し、それ以外を非表示にする（行を詰める）。 | 高 |

### 2.11 プリセット機能 (Phase 13)

**概要**: ユーザーが定義した工程パターン（プリセット）を保存・読み込みできる機能。

**仕様**:
*   **データ構造**:
    *   **Project Data (`project.json`)**: スケジュール、フェーズ、タグ設定を含む。
    *   **Global Settings (`settings.json`)**: 祝日設定、工程プリセット定義を含む。
*   **保存場所**: ローカルストレージ（`appSettings`）およびエクスポートされたJSONファイル。
*   **適用方法**:
    *   新規プロジェクト作成時（または「全削除」時）にプリセットを選択して適用。
    *   適用時は既存のフェーズリストはクリアされる。
*   **UI**:
    *   設定パネル内に「プリセット管理」セクションを追加。
    *   プリセットの新規作成（現在の状態から保存）、削除。
    *   設定データ（祝日+プリセット）のインポート/エクスポート機能。

